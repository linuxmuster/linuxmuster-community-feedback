#!/bin/bash


debug=1
CONFIGFILE=/etc/linuxmuster/linuxmuster-community-feedback.conf


# Source debconf library.
. /usr/share/debconf/confmodule

db_version 2.0

# create config if not exists
if [ ! -e $CONFIGFILE ]; then
    echo "# Config file for my linuxmuster-community-feedback" > $CONFIGFILE
    echo "SENDSTATS=" >> $CONFIGFILE
    echo "SENDUSERS=" >> $CONFIGFILE
    echo "SENDCLIENTS=" >> $CONFIGFILE
    echo "SENDLOCATION=" >> $CONFIGFILE
fi

db_get linuxmuster-community-feedback/sendstats

echo "RET $RET"
if [ "$RET" ]; then
    SENDSTATS=$RET;
fi

db_get linuxmuster-community-feedback/sendusers
if [ "$RET" ]; then
    SENDUSERS=$RET;
fi

db_get linuxmuster-community-feedback/sendclients
if [ "$RET" ]; then
    SENDCLIENTS=$RET;
fi

db_get linuxmuster-community-feedback/sendlocation
if [ "$RET" ]; then
    SENDLOCATION=$RET;
fi

# new an deleted values to config
test -z "$SENDSTATS" || grep -Eq '^ *SENDSTATS=' $CONFIGFILE || \
            echo "SENDSTATS=" >> $CONFIGFILE
test -z "$SENDUSERS" || grep -Eq '^ *SENDUSERS=' $CONFIGFILE || \
            echo "SENDUSERS=" >> $CONFIGFILE
test -z "$SENDCLIENTS" || grep -Eq '^ *SENDCLIENTS=' $CONFIGFILE || \
            echo "SENDCLIENTS=" >> $CONFIGFILE
test -z "$SENDLOCATION" || grep -Eq '^ *SENDLOCATION=' $CONFIGFILE || \
            echo "SENDLOCATION=" >> $CONFIGFILE

# write config
cp -a -f $CONFIGFILE $CONFIGFILE.tmp
sed -e "s/^ *SENDSTATS=.*/SENDSTATS=\"$SENDSTATS\"/" \
    -e "s/^ *SENDUSERS=.*/SENDUSERS=\"$SENDUSERS\"/" \
    -e "s/^ *SENDCLIENTS=.*/SENDCLIENTS=\"$SENDCLIENTS\"/" \
    -e "s/^ *SENDLOCATION=.*/SENDLOCATION=\"$SENDLOCATION\"/" \
    < $CONFIGFILE > $CONFIGFILE.tmp
mv -f $CONFIGFILE.tmp $CONFIGFILE

if [ $debug ]; then
    echo "Debug:"
fi

# dh_installdeb will replace this with shell code automatically

# dh_installdeb will replace this with shell code automatically
# generated by other debhelper scripts.

#DEBHELPER#

db_stop

exit 0
