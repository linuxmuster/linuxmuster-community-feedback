#!/bin/bash


debug=1
CONFIGFILE=/etc/linuxmuster/linuxmuster-community-feedback.conf


# Source debconf library.
. /usr/share/debconf/confmodule

db_version 2.0

# create config if not exists
if [ ! -e $CONFIGFILE ]; then
    echo "# Config file for my linuxmuster-community-feedback" > $CONFIGFILE
    echo "SENDSTATS=" >> $CONFIGFILE
    echo "SENDUSERS=" >> $CONFIGFILE
    echo "SENDCLIENTS=" >> $CONFIGFILE
    echo "SENDLOCATION=" >> $CONFIGFILE
fi

db_get linuxmuster-community-feedback/sendstats
db_input high linuxmuster-community-feedback/sendstats || true
db_go
if [ "$RET" ]; then
    SENDSTATS=$RET;
    
fi

db_get linuxmuster-community-feedback/virtualized
db_input high linuxmuster-community-feedback/virtualized || true
db_go
if [ "$RET" ]; then
    VIRTUALIZED=$RET;
fi


db_get linuxmuster-community-feedback/sendusers
db_input high linuxmuster-community-feedback/sendusers || true
db_go
if [ "$RET" ]; then
    SENDUSERS=$RET;
fi

db_get linuxmuster-community-feedback/sendclients
db_input high linuxmuster-community-feedback/sendclients || true
db_go
if [ "$RET" ]; then
    SENDCLIENTS=$RET;
fi

db_get linuxmuster-community-feedback/sendlocation
db_input high linuxmuster-community-feedback/sendlocation || true
db_go
if [ "$RET" ]; then
    SENDLOCATION=$RET;
fi

# new an deleted values to config
test -z "$SENDSTATS" || grep -Eq '^ *SENDSTATS=' $CONFIGFILE || \
            echo "SENDSTATS=" >> $CONFIGFILE
test -z "$SENDUSERS" || grep -Eq '^ *SENDUSERS=' $CONFIGFILE || \
            echo "SENDUSERS=" >> $CONFIGFILE
test -z "$SENDCLIENTS" || grep -Eq '^ *SENDCLIENTS=' $CONFIGFILE || \
            echo "SENDCLIENTS=" >> $CONFIGFILE
test -z "$SENDLOCATION" || grep -Eq '^ *SENDLOCATION=' $CONFIGFILE || \
            echo "SENDLOCATION=" >> $CONFIGFILE
test -z "$VIRTUALIZED" || grep -Eq '^ *VIRTUALIZED=' $CONFIGFILE || \
            echo "VIRTUALIZED=" >> $CONFIGFILE

# write config
cp -a -f $CONFIGFILE $CONFIGFILE.tmp
sed -e "s/^ *SENDSTATS=.*/SENDSTATS=\"$SENDSTATS\"/" \
    -e "s/^ *SENDUSERS=.*/SENDUSERS=\"$SENDUSERS\"/" \
    -e "s/^ *SENDCLIENTS=.*/SENDCLIENTS=\"$SENDCLIENTS\"/" \
    -e "s/^ *SENDLOCATION=.*/SENDLOCATION=\"$SENDLOCATION\"/" \
    -e "s/^ *VIRTUALIZED=.*/VIRTUALIZED=\"$VIRTUALIZED\"/" \
    < $CONFIGFILE > $CONFIGFILE.tmp
mv -f $CONFIGFILE.tmp $CONFIGFILE

# dh_installdeb will replace this with shell code automatically

# dh_installdeb will replace this with shell code automatically
# generated by other debhelper scripts.

#DEBHELPER#

db_stop

exit 0
